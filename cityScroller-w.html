<html>
	<head>
		<title>City Scroller</title>
		<script src="http://cloud.github.com/downloads/processing-js/processing-js/processing-1.4.1.min.js"></script>
		<script type="text/processing" data-processing-target="mycanvas">

		//Skyline(var bH, var s, var bC);
		Skyline btm = new Skyline(100, 3, color(191, 191, 191));
		Skyline mid = new Skyline(250, 2, color(81, 81, 81));
		Skyline top = new Skyline(350, 0.5, color(30, 30, 30));
		Horizon star = new Horizon(800, 100);
    var WINDOW_WIDTH = 700;
    var WINDOW_HEIGHT = 400;
    var BLUE = color(6, 27, 61);


        //This function only runs once at the start of the program
        void setup() {
          size(WINDOW_WIDTH, WINDOW_HEIGHT); //sets the size of the window
          frameRate(30); //how many times the draw function is called per second
					width = WINDOW_WIDTH;
        }

        //called repeatedly
        void draw() {
        	background(BLUE); //needed in the draw function to "clear" the screen between updates
					star.moveHorizon();
					top.moveSkyline();
					mid.moveSkyline();
					btm.moveSkyline();
        }

			class Star {
				var xPosition, yPosition, starColor;

				Star(var xPos, var yPos){
					xPosition = xPos;
					yPosition = yPos;
					starColor = color(255, 255, 255);
				}

				void drawStar(){
					fill(starColor);
					ellipse(xPosition, yPosition, 100, 100);
				}

				void updateStar(var speed){
					xPosition-=speed;
				}

				int getXs(){
					return xPosition;
				}
			}

			class Horizon {
				var xPosition;
				var yPosition;
				var speed;
				ArrayList<Star> starList;

			  Horizon(var xPos, var yPos){
			    xPosition = xPos;
			    yPosition = yPos;
					speed = 1;
					starList = new ArrayList<Star>();
					addStar();
			  }

			  void moveHorizon(){
			  	updateHorizon();
			  	drawHorizon();
			  }

			  void addStar(){
			    starList.add(new Star(xPosition, yPosition));
					println(starList.size());
			  }

			  void drawHorizon(){
				  for(var i = 0; i < starList.size(); i++){
				    Star currentStar = starList.get(i);
				    currentStar.drawStar();
				  }
			  }

			  void updateHorizon(){
				  for(var j = 0; j< starList.size(); j++){
				    Star currentStar = starList.get(j);
				    currentStar.updateStar(speed);
						}
						if(currentStar.getXs() < 0){
							addStar();
						if(currentStar.getXs() < -100){
							buildingList.remove(0);
						}
				  }
			  }
			}


      class Building {
        var xPosition, yPosition, buildingHeight, buildingWidth;
        var buildingColor;
        Building(var xPos, var bw, var bH, var bC) {
      		buildingHeight = random(30, bH);
      		buildingWidth = bw;
      		xPosition = xPos;
      		buildingColor = bC;
      	}

	    	void drawBuilding(){
	        fill(buildingColor);
	    		rect(xPosition,WINDOW_HEIGHT - buildingHeight,buildingWidth,buildingHeight);
	    	}

	    	void update(var speed){
	    		xPosition -= speed;
	    	}

				int getX(){
					return xPosition;
				}
	    }

			class Skyline {
			ArrayList<Building> buildingList;
			var xPosition;
			var randomBuildingWidth;
			var buildingHeight;
			var bW;
			var buildingColor;
			var UpperLimit;
			var speed;

			Skyline(var bH, var s, var bC){
				buildingList = new ArrayList<Building>();
				xPosition = 0;
				buildingHeight = bH;
				speed = s;
				buildingColor = bC;
				fillSkyline();//when a Skyline is created it automatically has enough buildings to fill the screen
			}

			void moveSkyline(){ //TODO:update and draw the skyline, add buildings as buildings leave the screen
				update();
				drawSkyline();
			}

			void addBuilding(){
				var randomBuildingWidth = random(40,80);
				buildingList.add(new Building(xPosition, randomBuildingWidth, buildingHeight, buildingColor));
				xPosition += randomBuildingWidth;
			}

			void fillSkyline(){ //TODO:add enough buildings to fill the screen
				var WINDOW_WIDTH  = 700;
				while(WINDOW_WIDTH > xPosition){
					addBuilding();
				}
			}

			void drawSkyline(){
				for(var i = 0; i < buildingList.size(); i++){
					Building currentBuilding = buildingList.get(i);
					currentBuilding.drawBuilding();
				}
			}

			void update(){ //TODO:loop through buildingList and update each Building
				for(var i = 0; i < buildingList.size(); i++){
					Building currentBuilding = buildingList.get(i);
					currentBuilding.update(speed);
					if(currentBuilding.getX() < 0){
						addBuilding();
					}
					if(currentBuilding.getX() < -currentBuilding.buildingWidth){
						buildingList.remove(0);
					}
				}
			}
		}
        </script>
    </head>

    <body>
		<canvas id="mycanvas"></canvas>
	</body>
</html>
